{% extends "base.html" %}
{% block content %}
  <h2>Личный кабинет</h2>

 {% if current_user.role == 'admin' %}
   <h1>Панель администратора</h1>

   <p>Всего состязаний: {{ competitions_count }}</p>
   <p>Всего лошадей: {{ horses_count }}</p>
   <p>Всего результатов: {{ results_count }}</p>

   <h2>Топ-3 жокея по рейтингу</h2>

   {% if top_jockeys %}
     <ul>
       {% for jockey in top_jockeys %}
         <li>
           {{ jockey.full_name }} —
           рейтинг: {{ jockey.rating if jockey.rating is not none else 'нет данных' }}
         </li>
       {% endfor %}
     </ul>
   {% else %}
     <p>Пока нет жокеев с заданным рейтингом.</p>
   {% endif %}

  {% elif current_user.role == 'jockey' %}
    <p>Вы вошли как жокей.</p>
    <h3>Мои результаты</h3>
    {% if results %}
      <table>
        <thead>
          <tr>
            <th>Дата</th>
            <th>Состязание</th>
            <th>Место</th>
            <th>Лошадь</th>
            <th>Показанное время</th>
          </tr>
        </thead>
        <tbody>
          {% for result in results %}
            <tr>
              <td>{{ result.competition.date.strftime("%d.%m.%Y") }}</td>
              <td>{{ result.competition.name }}</td>
              <td>{{ result.place or "—" }}</td>
              <td>{{ result.horse.name }}</td>
              <td>{{ result.race_time or "—" }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>Результатов пока нет.</p>
    {% endif %}

  {% elif current_user.role == 'owner' %}
    <p>Вы вошли как владелец лошади.</p>
    <h3>Мои лошади</h3>
    <p><a href="{{ url_for('horse_create') }}">Добавить лошадь</a></p>
    {% if horses %}
      <ul>
        {% for horse in horses %}
          <li>{{ horse.name }} ({{ horse.age or "возраст не указан" }} лет, {{ horse.sex or "пол не указан" }})</li>
        {% endfor %}
      </ul>
    {% else %}
      <p>У вас пока нет зарегистрированных лошадей.</p>
    {% endif %}

    <h3>Результаты моих лошадей</h3>
    {% if results %}
      <table>
        <thead>
          <tr>
            <th>Дата</th>
            <th>Состязание</th>
            <th>Место</th>
            <th>Лошадь</th>
            <th>Жокей</th>
            <th>Показанное время</th>
          </tr>
        </thead>
        <tbody>
          {% for result in results %}
            <tr>
              <td>{{ result.competition.date.strftime("%d.%m.%Y") }}</td>
              <td>{{ result.competition.name }}</td>
              <td>{{ result.place or "—" }}</td>
              <td>{{ result.horse.name }}</td>
              <td>{{ result.jockey.full_name }}</td>
              <td>{{ result.race_time or "—" }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>Результатов пока нет.</p>
    {% endif %}
  {% endif %}
{% endblock %}
